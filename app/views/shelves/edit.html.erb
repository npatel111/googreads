Edit your shelf:
<%=form_for @shelf do |f| %>
  <%=f.label :name %>
  <%=f.text_field :name %><br>
  <%User.find(session["user_id"]).shelves.each do |shelf|%>
    <%shelf.books.each do |book|%>
      <input type="checkbox" value="<%=book.id%>" name="shelf[book_ids][]" <%='checked' if @shelf.books.include?(book)%>><%=book.title%></input>
      <br>
    <%end%>
  <%end%>
  <%=f.submit%>
<%end%>
<br>
<%= link_to "Home", root_path %>
